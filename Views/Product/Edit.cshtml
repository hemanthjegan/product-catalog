@model product_catalog_ecommerce.Models.Product

@{
    ViewBag.Title = "Edit Product";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Edit Product</h2>

@using (Html.BeginForm())
{
    @Html.HiddenFor(m => m.ProductId)

    <div class="form-group">
        @Html.LabelFor(m => m.Name)
        @Html.TextBoxFor(m => m.Name, new { @class = "form-control" })
    </div>

    <div class="form-group">
        @Html.LabelFor(m => m.SKU)
        @Html.TextBoxFor(m => m.SKU, new { @class = "form-control" })
    </div>

    <div class="form-group">
        @Html.LabelFor(m => m.Price)
        @Html.TextBoxFor(m => m.Price, new { @class = "form-control", type = "number", step = "0.01" })
    </div>

    <div class="form-group">
        @Html.Label("Category")
        @Html.DropDownListFor(m => m.CategoryId,
            new SelectList(ViewBag.Categories, "CategoryId", "Name", Model.CategoryId),
            "Select Category",
            new { @class = "form-control", id = "CategorySelect" })
    </div>

    <div id="CategoryAttributes">
        @if (ViewBag.CategoryAttributes != null)
        {
            foreach (var attr in ViewBag.CategoryAttributes)
            {
                var value = Model.Attributes.FirstOrDefault(a => a.CategoryAttributeId == attr.CategoryAttributeId)?.Value;
                <div class="form-group">
                    <label>@attr.AttributeName</label>
                    <input type="text" name="attr_@attr.CategoryAttributeId" class="form-control" value="@value" />
                </div>
            }
        }
    </div>

    <button type="submit" class="btn btn-primary">Save Changes</button>
    @Html.ActionLink("Cancel", "Index", "Product", null, new { @class = "btn btn-default" })
}

@section scripts {
    <script>
        $(document).ready(function () {
            $('#CategorySelect').change(function () {
                var categoryId = $(this).val();
                $.get('@Url.Action("GetAttributes", "Product")', { categoryId: categoryId }, function (data) {
                    $('#CategoryAttributes').html(data);
                });
            });
        });
    </script>
}
